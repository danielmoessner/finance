{% extends "static/lm.njk" %}


{% set activePage="banking" %}
{% set headingCategory="Account" %}
{% set headingHeading=account.name %}
{% set title="Account " + account.name + " | Banking" %}


{% block head %}
	<script type="text/javascript" src="{{ static('js/line_bar_chart.js') }}" api-data="{{ url('banking:api_data_account', args=[user.slug, account.slug, ]) }}"></script>
{% endblock %}


{% block chart %}
	<div class="vs-3"></div>
   	<canvas class="chart--canvas" id="line_bar_chart"></canvas>
	<div class="vs-3"></div>
    <hr class="hr"> 
{% endblock %}


{% block main %} 


    {% import "modules/table.njk" as table %}
    {% import "modules/buttons.njk" as buttons %}
    {% import "modules/button.njk" as button %}
    {% import "modules/cards.njk" as cards %}
	   
       
    {%- set addChangeButton=button.modalButton("Deposit / Withdraw", "#addChange") -%}


    <div class="vs-1"></div>


	<div class="center-box">
        <div class="console" data-toggle="buttons">
        	<label class="console--button active" data-target=".console_stats">
                <input type="radio">Stats
            </label>
            <label class="console--button" data-target=".console_changes">
                <input type="radio">Changes
            </label>
        </div>
    </div>
	

	<div class="vs-3"></div>


	<div class="wrapper console-target console_stats">
        {{ heading.smallLmHeading("Stats") }}
        <div class="vs-1"></div>
        <div class="items-box">
            {{ cards.statsCard("Total", movie.get_values(user, ["b",])["b"], ext=user.currency) }}
        </div>
        {% for ts in timespans %}
            {% if ts.start_date and ts.is_active %}
                <div class="vs-3"></div>
                {{ heading.smallLmHeading(ts.name) }}
                <div class="vs-1"></div>
                <div class="items-box">
                    {% for data in movie.get_values(user, ["b",], ts) %}
                        {% set heading %}
                            {{ data.start_date }}-{{ data.end_date }}
                        {% endset %}
                        {% set value %}
                            Change: {{ data.b }}
                        {% endset %}
                        {{ cards.statsCard(heading, value) }}
                    {% endfor %}
                </div>
            {% endif %}
        {% endfor %}
    </div>


	<div class="wrapper console-target is-hidden console_changes">
        {{ heading.smallLmHeading("Changes", buttons=[addChangeButton]) }}
		<table class="table">
            {{ table.head(["Date", "Category", "Description", "Change", "Action"]) }}
            <tbody class="table--body">
                {% for change in changes %}
                    {% set tablebuttons %}
                        <div class="d-flex flex-row">
                            {% set data %}
                                {% raw %} { {% endraw %}
                                    'pk': '{{ change.pk }}', 
                                    'account': '{{ account.pk }}',
                                    'category': '{{ change.category.pk }}',
                                    'date': '{{ change.date }}',
                                    'description': '{{ change.description }}',
                                    'change': '{{ change.change }}'
                                {% raw %} } {% endraw %}
                            {% endset %}
                            {{ buttons.buttonModalNew(text="Edit", dataTarget="#editChange", data=data) }}
                            <div class="hs-1"></div>
                            <form method="POST" action="{{ url('banking:delete_change', args=[user.slug, account.slug]) }}">
                                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                                <input type="hidden" name="pk" value="{{ change.pk }}">
                                <input type="submit" class='btn btn-sm btn-danger' value="Delete">
                            </form>
                        </div>  
                    {% endset %} 
                    {{ table.row([change.get_date(user), change.category, change.get_description(), change.change, tablebuttons | safe]) }}
                    {#{ table.row([change.get_date(user), change.category, change.get_description(), change.change, picture.b, tablebuttons | safe]) }#}
                {% endfor %}
            </tbody>
        </table>
	</div>
	

{% endblock %}


{% block modals %}
    {% import "modules/banking/modals.njk" as modals %}
    {{ modals.editChangeModal(user, account, accounts, categories, csrf_token) }}
	{{ modals.addChangeModal(user, url("banking:add_change", args=[user.slug, account.slug]), categories, csrf_token) }}
{% endblock %}
