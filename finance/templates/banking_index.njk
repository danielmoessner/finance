{% extends "static/lm.njk" %}


{% set activePage="banking" %}
{% set headingCategory="Dashboard" %}
{% set headingHeading="Banking" %}
{% set title="Banking" %}


{% block head %}
	<script src="{{ static('js/line_chart.js') }}" api-data="{{ url('banking:api_data_index') }}"></script>
	<script src="{{ static('js/stacked_bar_chart.js') }}" api-data="{{ url('banking:api_data_categories_month') }}"></script>
{% endblock %}


{% block chart %}
	<div class="vs-3"></div>
	<canvas class="console-target is-hidden console_accounts" id="line_chart"></canvas>
	<canvas class="console-target console_stats console_categories console_timespans" id="stacked_bar_chart"></canvas>
	<div class="vs-3"></div>
	<hr class="hr"> 
{% endblock %}


{% block main %}

	
	{% import "modules/table.njk" as tg %}
	{% import "modules/button.njk" as bg %}
	{% import "modules/card.njk" as cg %}
	{% import "modules/timespan.njk" as tsg %}
	{% import "modules/modal.njk" as mg %}


	{%- set addAccountButton=bg.modalButton("Add Account", "#addAccount") -%}
	{%- set deleteAccountButton=bg.modalButton("Delete Account", "#deleteAccount") -%}
	{%- set addCategoryButton=bg.modalButton("Add Category", "#addCategory") -%}
	{%- set deleteCategoryButton=bg.modalButton("Delete Category", "#deleteCategory") -%}
	{%- set addTimespanButton=bg.modalButton("Add Timespan", "#addTimespan") -%}
	{%- set updateButton=bg.hrefButton("Update", url("banking:update_movies")) -%}
	{%- set resetButton=bg.hrefButton("Reset", url("banking:reset_movies")) -%}


	<div class="vs-1"></div>

	
	<div class="center-box">
		<div class="console" data-toggle="buttons">
			<button class="console--button active" type="button" data-target=".console_stats">Stats</button>
			<button class="console--button" type="button" data-target=".console_accounts">Accounts</button>
			<button class="console--button" type="button" data-target=".console_categories">Categories</button>
			<button class="console--button" type="button" data-target=".console_timespans">Time Spans</button>
		</div>
	</div>


	<div class="vs-3"></div>

	
	<div class="wrapper console-target console_stats">
		{{ hg.smallLmHeading("Stats", buttons=[updateButton, resetButton]) }}
		<div class="vs-1"></div>
		<div class="items-box">
			{{ cg.statsCard("Total", movie.get_values(user, ["b",])["b"], ext=user.currency) }}
		</div>
		{% if timespan.start_date %}
			<div class="vs-3"></div>
			{{ hg.smallLmHeading(timespan.name) }}
			<div class="vs-1"></div>
			<div class="items-box">
				{% with data=movie.get_values(user, ["b",], timespan) %}
					{%- set heading=data.start_date+"-"+data.end_date -%}
					{%- set value="Change: "+data.b|string -%}
					{{ cg.statsCard(heading, value) }}
				{% endwith %}
			</div>
		{% endif %}
	</div>


	<div class="wrapper console-target is-hidden console_accounts">
		{{ hg.smallLmHeading("Accounts", buttons=[addAccountButton, deleteAccountButton]) }}
		<table class="table">
			{{ tg.head(["Account", "Balance", "Action"]) }}
			<tbody class="table--body">
				{% for account, movie in accounts_movies %}
					{% set tablebuttons %}
						<div class="table--buttons">
							{{ bg.modalButton("Deposit / Withdraw", "#addChange"+account.slug) }}
							<div class="hs-1"></div>
							{{ bg.modalButton("Edit", "#editAccount"+account.slug) }}  
						</div>
						{{ mg.djangoModal("Deposit / Withdraw", "addChange"+account.slug, url("banking:add_change", args=[account.slug])) }}
						{{ mg.djangoModal("Edit Account", "editAccount"+account.slug, url("banking:edit_account", args=[account.slug])) }}
					{% endset %}
					{% set name %}
						<a href="{{ url('banking:account', args=[account.slug]) }}" class="link-bold">{{ account.name }}</a> 
					{% endset %}
					{%- set values=movie.get_values(user, ["b"]) -%}
					{{ tg.row([name|safe, values["b"], tablebuttons|safe]) }}
				{% endfor %}
			</tbody>
		</table>
	</div>

 
	<div class="wrapper console-target is-hidden console_categories">
		{{ hg.smallLmHeading("Categories", buttons=[addCategoryButton, deleteCategoryButton]) }}
		<table class="table">
			{{ tg.head(["Category", "Description", "Action"]) }}
			<tbody class="table--body">
				{% for category in categories %}
					{% set tablebuttons %}
						{{ bg.modalButton("Edit", "#editCategory"+category.slug) }}  
						{{ mg.djangoModal("Edit Category", "editCategory"+category.slug, url("banking:edit_category", args=[category.slug])) }}
					{% endset %} 
					{% set name %}
						<a href="{{ url('banking:category', args=[category.slug]) }}" class="link-bold">{{ category.name }}</a>
					{% endset %}
					{{ tg.row([name|safe, category.description, tablebuttons|safe]) }}
				{% endfor %}
			</tbody>
		</table>
	</div>
	

	<div class="wrapper console-target is-hidden console_timespans">
		{{ hg.smallLmHeading("Timespans", buttons=[addTimespanButton]) }}
		<table class="table">
			{{ tg.head(["Name", "Start Date", "End Date", "Action"]) }}
			<tbody class="table--body">
				{% for timespan in timespans %}
					{% set tablebuttons %}
						<div class="table--buttons">
							{{ tsg.setActiveForm(timespan, csrf_token) }}
							<div class="hs-1"></div>
							{{ tsg.deleteButton(timespan, csrf_token) }}
						</div>
						{{ mg.djangoModal("Delete", "deleteTimespan"+timespan.pk|string, url("banking:delete_timespan", args=[timespan.pk])) }}
					{% endset %} 
					{{ tg.row([timespan.name, timespan.start_date, timespan.end_date, tablebuttons|safe]) }}
				{% endfor %}
			</tbody>
		</table>
	</div>


{% endblock %}


{% block modals %}
	{% import "modules/modal.njk" as mg %}
	{{ mg.djangoModal("Add Account", "addAccount", url("banking:add_account")) }}
	{{ mg.djangoModal("Delete Account", "deleteAccount", url("banking:delete_account")) }}
	{{ mg.djangoModal("Add Category", "addCategory", url("banking:add_category")) }}
	{{ mg.djangoModal("Delete Category", "deleteCategory", url("banking:delete_category")) }}
	{{ mg.djangoModal("Add Timespan", "addTimespan", url("banking:add_timespan")) }}	
{% endblock %}
