{% extends "static/lm.njk" %}


{% set activePage="settings" %}
{% set headingCategory="User" %}
{% set headingHeading="Settings" %}
{% set title="Settings" %}


{% block main %} 
	

	{% import "modules/form_childs.njk" as childs %}
	{% import "modules/buttons.njk" as buttons %}
	{% import "modules/table.njk" as table %}


	<div class="hs-1"></div>


	<div class="divider">
        <div class="divider--content"> 
            <div class="console" data-toggle="buttons">
                <label class="console--button active" data-target=".console_general">
                    <input type="radio">General
                </label>
                <label class="console--button" data-target=".console_user">
                    <input type="radio">User
                </label>
                {% if user.banking_is_active %}
                <label class="console--button" data-target=".console_banking">
                    <input type="radio">Banking
                </label>
                {% endif %}
                {% if user.crypto_is_active %}
                <label class="console--button" data-target=".console_crypto">
                    <input type="radio">Crypto
                </label>
                {% endif %}
            </div>
        </div>
    </div>


	<div class="hs-3"></div>


	<div class="wrapper console-target console_general">
		<div class="table-heading">
	        <h2 class="table-heading--heading">General</h2>
	    </div>
		<hr class="hr">
		<div class="settings">
			<form action="{{ url('users:edit_user_specials', args=[user.slug,]) }}" method="POST">
				<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
				<input type="hidden" name="rounded_numbers" value="{{ rounded_numbers }}">
				{{ childs.tupleSelect("Select A Date Format", "date_format", date_formats[1], selected=date_formats[0]) }}
				{{ childs.tupleSelect("Select A Currency", "currency", currencies[1], selected=currencies[0]) }}
				{{ childs.tupleSelect("Front Page", "front_page", front_pages[1], selected=front_pages[0])}}
				<input type="submit" value="Update" class="form-child--submit-button">
			</form> 
		</div> 

		<div class="table-heading">
	        <h2 class="table-heading--heading">Apps</h2>
	    </div>
		<hr class="hr">
		<div class="settings">
			<div class="column">
				<div class="column--left">
					<h3 class="column--heading">Banking</h3>
					<div class="column--spacer"></div>
					<h3 class="column--heading">Crypto</h3>
				</div>
				<div class="column--right">
					{% set data %}
						btn-info btn-sm column--button {% if user.crypto_is_active %}disabled{% endif %}
					{% endset %}
					{{ buttons.buttonLink(text="Init", url=url("users:init_banking", args=[user.slug,]), class=data) }}
					<div class="column--spacer"></div>
					{{ buttons.buttonLink(text="Init", url=url("users:init_crypto", args=[user.slug,]), class=data) }}
				</form>
				</div>
			</div>
		</div>
	</div>


	<div class="wrapper console-target console_user is-hidden">	
		<div class="table-heading">
	        <h2 class="table-heading--heading">@{{ user.username }}</h2>
	    </div>
		<hr class="hr">
		<div class="settings">
			<form action="{{ url('users:edit_user', args=[user.slug,]) }}" method="POST">
				<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
				{{ childs.textInput("Username", "username", value=user.username) }}
				{{ childs.textInput("E-Mail", "email", value=user.email) }}
				<input type="submit" value="Update" class="form-child--submit-button">
			</form>
		</div>

		<div class="table-heading">
	        <h3 class="table-heading--heading">Password</h3>
	    </div>
	    <hr class="hr">
		<div class="settings">
			<form action="{{ url('users:edit_user_password', args=[user.slug,]) }}" method="POST">
				<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
				{{ childs.passwordInput("Old Password", "old_password") }}
				{{ childs.passwordInput("New Password", "new_password1") }}
				{{ childs.passwordInput("Retype New Password", "new_password2") }}
				<input type="submit" value="Change Password" class="form-child--submit-button">
			</form>
		</div> 
	</div>


	<div class="wrapper console-target console_banking is-hidden">
		<div class="table-heading">
	        <h2 class="table-heading--heading">Depots</h2>
	        {{ buttons.buttonModal(text="Add Depot", dataTarget="#addBankingDepot") }} 
	    </div>
		<table class="table">
            {{ table.head(["Depot", "Action"]) }}
            <tbody class="table--body">
                {% for depot in banking_depots %}
                    {% set tablebuttons %}
                        <div class="d-flex flex-row">  
                        	<a type="button" href={{ url("users:set_banking_depot_active", args=[user.slug, depot.pk, ]) }} class="btn btn-sm btn-info {% if depot.is_active==True %}disabled{% endif %}" role="button">Set Active</a>
                            <div class="placeholder"></div>
                            {% set data %}
                                {% raw %} { {% endraw %}
                                    'pk': '{{ depot.pk }}', 
                                    'name': '{{ depot.name }}'
                                {% raw %} } {% endraw %}
                            {% endset %}
                            {{ buttons.buttonModalNew(text="Edit", dataTarget="#editBankingDepot", data=data) }}
                            <div class="placeholder"></div>
                            <form method="POST" action="{{ url('users:delete_banking_depot', args=[user.slug,]) }}" class="">
                                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                                <input type="hidden" name="pk" value="{{ depot.pk }}">
                                <input type="submit" class="btn btn-sm btn-danger" {% if depot.is_active==True %}disabled{% endif %} value="Delete">
                            </form>
                        </div>
                    {% endset %} 
                    {{ table.row([depot.name, tablebuttons]) }}
                {% endfor %}
            </tbody>
        </table>
	</div>


	<div class="wrapper console-target console_crypto is-hidden">
		<div class="table-heading">
	        <h2 class="table-heading--heading">General</h2>
	    </div>
	    <hr class="hr">
		<div class="settings">
			<form action="{{ url('users:edit_user_specials', args=[user.slug,]) }}" method="POST">
				<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
				<input type="hidden" name="date_format" value="{{ date_formats[0] }}">
				<input type="hidden" name="currency" value="{{ currencies[0] }}">
				<input type="hidden" name="front_page" value="{{ front_pages[0] }}">
				{{ childs.select("Round Numbers To 2 Decimal Places", "rounded_numbers", ["True", "False"], selected=rounded_numbers)}}

				<input type="submit" value="Update" class="form-child--submit-button">
			</form> 
		</div> 

		<div class="table-heading">
	        <h2 class="table-heading--heading">Depots</h2>
	        {{ buttons.buttonModal(text="Add Depot", dataTarget="#addCryptoDepot") }}
	    </div>
		<table class="table">
            {{ table.head(["Depot", "Action"]) }}
            <tbody class="table--body">
                {% for depot in crypto_depots %}
                    {% set tablebuttons %}
                        <div class="d-flex flex-row">  
                        	<a type="button" href={{ url("users:set_crypto_depot_active", args=[user.slug, depot.pk, ]) }} class="btn btn-sm btn-info {% if depot.is_active==True %}disabled{% endif %}"" role="button">Set Active</a>
                            <div class="placeholder"></div>
                            {% set data %}
                                {% raw %} { {% endraw %}
                                    'pk': '{{ depot.pk }}', 
                                    'name': '{{ depot.name }}'
                                {% raw %} } {% endraw %}
                            {% endset %}
                            {{ buttons.buttonModalNew(text="Edit", dataTarget="#editCryptoDepot", data=data) }}
                            <div class="placeholder"></div>
                            <form method="POST" action="{{ url('users:delete_crypto_depot', args=[user.slug,]) }}" class="">
                                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                                <input type="hidden" name="pk" value="{{ depot.pk }}">
                                <input type="submit" class="btn btn-sm btn-danger" {% if depot.is_active==True %}disabled{% endif %} value="Delete">
                            </form>
                        </div>
                    {% endset %} 
                    {{ table.row([depot.name, tablebuttons]) }}
                {% endfor %}
            </tbody>
        </table>
	</div>

 
{% endblock %}

 
{% block modals %}
	{% import "modules/banking/modals.njk" as bankingModals %}
	{{ bankingModals.addBankingDepotModal(user, csrf_token) }}
	{{ bankingModals.editBankingDepotModal(user, csrf_token) }}
	{{ bankingModals.deleteBankingDepotModal(user, banking_depots, csrf_token) }}
	{% import "modules/crypto/modals.njk" as cryptoModals %}
	{{ cryptoModals.addCryptoDepotModal(user, csrf_token) }}
	{{ cryptoModals.editCryptoDepotModal(user, csrf_token) }}
	{{ cryptoModals.deleteCryptoDepotModal(user, crypto_depots, csrf_token) }}
{% endblock %}