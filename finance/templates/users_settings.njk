{% extends "static/lm.njk" %}


{% set activePage="settings" %}
{% set headingCategory="User" %}
{% set headingHeading="Settings" %}
{% set title="Settings" %}


{% block main %} 
	

	{% import "modules/buttons.njk" as buttons %}
	{% import "modules/button.njk" as button %}
	{% import "modules/table.njk" as table %}
	{% import "modules/form.njk" as fg %}
	{% import "modules/heading.njk" as heading %}
	

	{%- set addBankingDepotButton=button.modalButton("Add Depot", "#addBankingDepot") -%}
	{%- set addCryptoDepotButton=button.modalButton("Add Depot", "#addCryptoDepot") -%}


	<div class="vs-1"></div>


	<div class="center-box">
        <div class="console" data-toggle="buttons">
            <label class="console--button active" data-target=".console_general">
                <input type="radio">General
            </label>
            <label class="console--button" data-target=".console_user">
                <input type="radio">User
            </label>
            {% if user.banking_is_active %}
                <label class="console--button" data-target=".console_banking">
                    <input type="radio">Banking
                </label>
            {% endif %}
            {% if user.crypto_is_active %}
                <label class="console--button" data-target=".console_crypto">
                    <input type="radio">Crypto
                </label>
            {% endif %}
        </div>
    </div>


	<div class="vs-3"></div>


	<div class="wrapper console-target console_general">
		{{ hg.smallLmHeading("General") }}
		<div class="lm-box">
			{{ fg.formGenerator(edit_user_general_form, url('users:edit_user_general', args=[user.slug]), csrf_token) }}
		</div> 

		{{ hg.smallLmHeading("Apps") }}
		<div class="lm-box">
			<div class="column">
				<div class="column--left">
					<h3 class="column--heading">Banking</h3>
					<div class="column--spacer"></div>
					<h3 class="column--heading">Crypto</h3>
				</div>
				<div class="column--right">
					{% set data %}
						btn-info btn-sm column--button {% if user.crypto_is_active %}disabled{% endif %}
					{% endset %}
					{{ buttons.buttonLink(text="Init", url=url("users:init_banking", args=[user.slug,]), class=data) }}
					<div class="column--spacer"></div>
					{{ buttons.buttonLink(text="Init", url=url("users:init_crypto", args=[user.slug,]), class=data) }}
				</form>
				</div>
			</div>
		</div>
	</div>


	<div class="wrapper console-target console_user is-hidden">	
		{{ hg.smallLmHeading("@"+user.username) }}
		<div class="lm-box">
			{{ fg.formGenerator(edit_user_form, url('users:edit_user', args=[user.slug]), csrf_token) }}
		</div>

		{{ hg.smallLmHeading("Password") }}
		<div class="lm-box">
			{{ fg.formGenerator(edit_user_password_form, url('users:edit_user_password', args=[user.slug]), csrf_token) }}
		</div> 
	</div>


	<div class="wrapper console-target console_banking is-hidden">
	    {{ hg.smallLmHeading("Depots", buttons=[addBankingDepotButton]) }}
		<table class="table">
            {{ table.head(["Depot", "Action"]) }}
            <tbody class="table--body">
                {% for depot in banking_depots %}
                    {% set tablebuttons %}
                        <div class="d-flex flex-row">  
                        	<a type="button" href={{ url("users:set_banking_depot_active", args=[user.slug, depot.pk, ]) }} class="btn btn-sm btn-info {% if depot.is_active==True %}disabled{% endif %}" role="button">Set Active</a>
                            <div class="vs-1"></div>
                            {% set data %}
                                {% raw %} { {% endraw %}
                                    'pk': '{{ depot.pk }}', 
                                    'name': '{{ depot.name }}'
                                {% raw %} } {% endraw %}
                            {% endset %}
                            {{ buttons.buttonModalNew(text="Edit", dataTarget="#editBankingDepot", data=data) }}
                            <div class="vs-1"></div>
                            <form method="POST" action="{{ url('users:delete_banking_depot', args=[user.slug,]) }}" class="">
                                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                                <input type="hidden" name="pk" value="{{ depot.pk }}">
                                <input type="submit" class="btn btn-sm btn-danger" {% if depot.is_active==True %}disabled{% endif %} value="Delete">
                            </form>
                        </div>
                    {% endset %} 
                    {{ table.row([depot.name, tablebuttons]) }}
                {% endfor %}
            </tbody>
        </table>
	</div>


	<div class="wrapper console-target console_crypto is-hidden">
		{{ hg.smallLmHeading("General") }}
		<div class="lm-box">
			<form action="{{ url('users:edit_user_crypto', args=[user.slug]) }}" method="POST">
				<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
				{{ edit_user_crypto_form.as_p() }}
				<input type="submit" value="Update" class="form-child--submit-button">
			</form> 
		</div> 
		
		{{ hg.smallLmHeading("Depots", buttons=[addCryptoDepotButton]) }}
		<table class="table">
            {{ table.head(["Depot", "Action"]) }}
            <tbody class="table--body">
                {% for depot in crypto_depots %}
                    {% set tablebuttons %}
                        <div class="d-flex flex-row">  
                        	<a type="button" href={{ url("users:set_crypto_depot_active", args=[user.slug, depot.pk, ]) }} class="btn btn-sm btn-info {% if depot.is_active==True %}disabled{% endif %}"" role="button">Set Active</a>
                            <div class="vs-1"></div>
                            {% set data %}
                                {% raw %} { {% endraw %}
                                    'pk': '{{ depot.pk }}', 
                                    'name': '{{ depot.name }}'
                                {% raw %} } {% endraw %}
                            {% endset %}
                            {{ buttons.buttonModalNew(text="Edit", dataTarget="#editCryptoDepot", data=data) }}
                            <div class="vs-1"></div>
                            <form method="POST" action="{{ url('users:delete_crypto_depot', args=[user.slug,]) }}" class="">
                                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                                <input type="hidden" name="pk" value="{{ depot.pk }}">
                                <input type="submit" class="btn btn-sm btn-danger" {% if depot.is_active==True %}disabled{% endif %} value="Delete">
                            </form>
                        </div>
                    {% endset %} 
                    {{ table.row([depot.name, tablebuttons]) }}
                {% endfor %}
            </tbody>
        </table>
	</div>

 
{% endblock %}

 
{% block modals %}
	{% import "modules/banking/modals.njk" as bankingModals %}
	{{ bankingModals.addBankingDepotModal(user, csrf_token) }}
	{{ bankingModals.editBankingDepotModal(user, csrf_token) }}
	{{ bankingModals.deleteBankingDepotModal(user, banking_depots, csrf_token) }}
	{% import "modules/crypto/modals.njk" as cryptoModals %}
	{{ cryptoModals.addCryptoDepotModal(user, csrf_token) }}
	{{ cryptoModals.editCryptoDepotModal(user, csrf_token) }}
	{{ cryptoModals.deleteCryptoDepotModal(user, crypto_depots, csrf_token) }}
{% endblock %}