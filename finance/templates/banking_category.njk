{% extends "layout/lm.njk" %}


{% set activePage="banking" %}
{% set headingCategory="Category" %}
{% set headingHeading=category.name %}
{% set title="Category " + category.name + " | Banking" %}


{% block head %}
    <script type="text/javascript" src="{{ static('js/bar_chart.js') }}" api-data="{{ url('banking:api_data_category', args=[category.slug]) }}"></script>
{% endblock %}


{% block chart %}
    <div class="vs-3"></div>
    <canvas id="bar_chart"></canvas>
    <div class="vs-3"></div>
    <hr class="hr"> 
{% endblock %}
 

{% block main %}
    

    {% import "modules/table.njk" as tg %}
    {% import "modules/button.njk" as bg %}
    {% import "modules/card.njk" as cg %}
    {% import "modules/modal.njk" as mg %}
    {% import "modules/console.njk" as cog %}
   

    <div class="vs-1"></div>
    
    
    <div class="center-box">
        <div class="console" data-toggle="buttons">
            <button class="console--button {{ cog.isActive(console, 'console-main') }}" type="button" data-target="#stats">Stats</button>
            <button class="console--button {{ cog.isActive(console, 'changes') }}" type="button" data-target="#changes">Changes</button>
        </div>
    </div>


    <div class="vs-3"></div>
    
    
    <div class="wrapper console--target {{ cog.isHidden(console, 'console-main') }}" id="stats">
        {{ hg.smallLmHeading("Info") }}
        <div class="vs-1"></div>
        <div class="items-box">
            {{ cg.statsCard("Total Change", movie.get_values(user, ["b"])["b"]) }}
            {{ cg.statsCard("Description", category.description) }}
        </div>
        {% if timespan.start_date %}
            <div class="vs-3"></div>
            {{ hg.smallLmHeading(timespan.name, right=timespan.get_start_date() + " - " + timespan.get_end_date()) }}
            <div class="vs-1"></div>
            <div class="items-box">
                {{ cg.statsCard("Change", movie.get_values(user, ["b"], timespan)["b"]) }}
            </div>
        {% endif %}
    </div>


    <div class="wrapper console--target {{ cog.isHidden(console, 'changes') }}" id="changes">
        {{ hg.smallLmHeading("Changes") }}
        <div class="scrollbar-box">
            <table class="table">
                {{ tg.head(["Date", "Category", "Description", "Change", "Balance", "Action"]) }}
                <tbody class="table--body">
                    {% for change in changes %}
                        {% set tablebuttons %}
                            <div class="table--buttons">
                                {{ bg.modalButton("Edit", "#editChange"+change.pk|string) }}
                                <div class="hs-1"></div>
                                {{ bg.modalButton("Delete", "#deleteChange"+change.pk|string) }}
                            </div>  
                            {{ mg.djangoModal("Edit Change", "editChange"+change.pk|string, url("banking:edit_change", args=[category.slug, change.pk])) }}
                            {{ mg.djangoModal("Delete Change", "deleteChange"+change.pk|string, url("banking:delete_change", args=[category.slug, change.pk])) }}
                        {% endset %} 
                        {{ tg.row([change.get_date(user), change.category, change.get_description(), change.change, change.get_balance(movie), tablebuttons|safe]) }}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="center-box">
            {{ cog.paginatorConsole("changes", changes) }}
        </div>
    </div>
    

{% endblock %}
