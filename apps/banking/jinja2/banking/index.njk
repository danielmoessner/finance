{% extends "layout/lm.njk" %}

{% set headingCategory="Dashboard" %}
{% set headingHeading="Banking" %}
{% set title="Banking" %}

{% block main %}

{% import "modules/table.njk" as tg %}
{% import "modules/button.njk" as bg %}
{% import "modules/card.njk" as cg %}
{% import "modules/timespan.njk" as tsg %}
{% import "modules/modal.njk" as mg %}
{% import "modules/console.njk" as cog %}

<div class="d-flex justify-content-center mt-2 mb-5">
    <div class="btn-group" role="group" aria-label="Console">
        {{ bg.hrefButton("Stats", request.path + '?tab=stats', active=(tab=='stats')) }}
        {{ bg.hrefButton("Accounts", request.path + '?tab=accounts', active=(tab=='accounts')) }}
        {{ bg.hrefButton("Categories", request.path + '?tab=categories', active=(tab=='categories')) }}
        {{ bg.hrefButton("Charts", request.path + '?tab=charts', active=(tab=='charts')) }}
    </div>
</div>

<div class="d-flex justify-content-end mb-3">
    {{ bg.hrefButton("Reset Balances", url("banking:reset_balances")) }}
</div>

{% include 'symbols/stats.j2' %}

{% if tab=='accounts' %}
    <table class="table rounded table-responsive-md table-dark">
        <thead>
        <tr>
            <th class="border-0" scope="col">Account</th>
            <th class="border-0" scope="col">Balance</th>
            <th class="border-0" scope="col">Action</th>
        </tr>
        </thead>
        <tbody>
        {% for account in accounts %}
            <tr>
                <td>{{ account.name }}</td>
                <td>{{ account.get_stats()['Balance'] }}</td>
                <td>
                    <div class="d-flex align-items-center">
                        {{ mg.djangoModal("Deposit / Withdraw", "addChange"+account.slug, url("banking:add_change", args=[account.slug])) }}
                        {{ bg.modalButton("Deposit / Withdraw", "#addChange"+account.slug) }}
                        {{ mg.djangoModal("Edit Account", "editAccount"+account.slug, url("banking:edit_account", args=[account.slug])) }}
                        {{ bg.modalButton("Edit", "#editAccount"+account.slug) }}
                        {{ bg.hrefButton("Open", url("banking:account", args=[account.slug])) }}
                    </div>
                </td>
            </tr>
        {% endfor %}
        <tr>
            <td colspan="3">
                <div class="d-flex">
                    {{ mg.djangoModal("Add Account", "addAccount", url("banking:add_account")) }}
                    {{ bg.modalButton("Add Account", "#addAccount") }}
                    {{ mg.djangoModal("Delete Account", "deleteAccount", url("banking:delete_account")) }}
                    {{ bg.modalButton("Delete Account", "#deleteAccount") }}
                </div>
            </td>
        </tr>
        </tbody>
    </table>
{% endif %}

{% if tab=='categories' %}
    <table class="table rounded table-responsive-md table-dark">
        <thead>
        <tr>
            <th class="border-0" scope="col">Category</th>
            <th class="border-0" scope="col">Change</th>
            <th class="border-0" scope="col">Action</th>
        </tr>
        </thead>
        <tbody>
        {% for category in categories %}
            <tr>
                <td>{{ category.name }}</td>
                <td>{{ category.get_stats()['Change'] }}</td>
                <td>
                    <div class="d-flex">
                        {{ bg.modalButton("Edit", "#editCategory"+category.slug) }}
                        {{ mg.djangoModal("Edit Category", "editCategory"+category.slug, url("banking:edit_category", args=[category.slug])) }}
                        {{ bg.hrefButton("Open", url("banking:category", args=[category.slug])) }}
                    </div>
                </td>
            </tr>
        {% endfor %}
        <tr>
            <td colspan="3">
                <div class="d-flex">
                    {{ mg.djangoModal("Add Category", "addCategory", url("banking:add_category")) }}
                    {{ bg.modalButton("Add Category", "#addCategory") }}
                    {{ mg.djangoModal("Delete Category", "deleteCategory", url("banking:delete_category")) }}
                    {{ bg.modalButton("Delete Category", "#deleteCategory") }}
                </div>
            </td>
        </tr>
        </tbody>
    </table>
{% endif %}

{% if tab=='charts' %}
    <script src="https://www.amcharts.com/lib/4/core.js"></script>
    <script src="https://www.amcharts.com/lib/4/charts.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
    {% include 'banking/symbols/balance_chart.html' %}
    {% include 'banking/symbols/income_and_expenditure_chart.html' %}
{% endif %}

{% endblock %}
